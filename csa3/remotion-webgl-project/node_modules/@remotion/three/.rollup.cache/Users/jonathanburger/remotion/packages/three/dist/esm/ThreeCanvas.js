import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { Canvas, useThree } from '@react-three/fiber';
import { useCallback, useLayoutEffect, useState } from 'react';
import { continueRender, delayRender, Internals } from 'remotion';
import { SuspenseLoader } from './SuspenseLoader';
import { validateDimension } from './validate';
const Scale = ({ width, height }) => {
    const { set, setSize: threeSetSize } = useThree();
    const [setSize] = useState(() => threeSetSize);
    useLayoutEffect(() => {
        setSize(width, height);
        set({ setSize: () => null });
        return () => set({ setSize });
    }, [setSize, width, height, set]);
    return null;
};
/**
 * @description A wrapper for React Three Fiber's <Canvas /> which synchronizes with Remotions useCurrentFrame().
 * @see [Documentation](https://www.remotion.dev/docs/three-canvas)
 */
export const ThreeCanvas = (props) => {
    const { children, width, height, style, onCreated, ...rest } = props;
    const [waitForCreated] = useState(() => delayRender('Waiting for <ThreeCanvas/> to be created'));
    validateDimension(width, 'width', 'of the <ThreeCanvas /> component');
    validateDimension(height, 'height', 'of the <ThreeCanvas /> component');
    const contexts = Internals.useRemotionContexts();
    const actualStyle = {
        width: props.width,
        height: props.height,
        ...(style !== null && style !== void 0 ? style : {}),
    };
    const remotion_onCreated = useCallback((state) => {
        continueRender(waitForCreated);
        onCreated === null || onCreated === void 0 ? void 0 : onCreated(state);
    }, [onCreated, waitForCreated]);
    return (_jsx(SuspenseLoader, { children: _jsxs(Canvas, { style: actualStyle, ...rest, onCreated: remotion_onCreated, children: [_jsx(Scale, { width: width, height: height }), _jsx(Internals.RemotionContextProvider, { contexts: contexts, children: children })] }) }));
};
